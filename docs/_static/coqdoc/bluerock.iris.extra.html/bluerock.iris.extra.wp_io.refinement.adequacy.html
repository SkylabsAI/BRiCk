<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
-- Copyright (c) 2020 BlueRock Security, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="../../css/coqdocjs/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="../../css/coqdocjs/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../js/coqdocjs/config.js"></script>
<script type="text/javascript" src="../../js/coqdocjs/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <!-- NOTE: These are displayed right to left on the page -->
    <span class="right">
      <a href="./indexpage.html"> Index for the theory </a>
      <a href="./toc.html"> Table of contents for the theory </a>
      <a href="../../../index.html"> Toplevel </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">bluerock.iris.extra.wp_io.refinement.adequacy</h1>

<div class="code">
<span class="comment">(*<br/>
&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2023&nbsp;BlueRock&nbsp;Security,&nbsp;Inc.<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;This&nbsp;software&nbsp;is&nbsp;distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;BedRock&nbsp;Open-Source&nbsp;License.<br/>
&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE-BedRock&nbsp;file&nbsp;in&nbsp;the&nbsp;repository&nbsp;root&nbsp;for&nbsp;details.<br/>
&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
<a id="lab104"></a><h1 class="section">Extracting refinement relation between traces from Iris adequacy.</h1>


<div class="paragraph"> </div>

We also have two variants, one for embedded refinement relation and one for
an refinement invariant.
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">refine_embed.trace_refinement_adequacy</span></span> extracts the refinement from the instrumented
  state interpretation.

</li>
<li> <span class="inlinecode"><span class="id" title="var">refine_inv.trace_refinement_adequacy</span></span> extracts the refinement from the root invariant
  <span class="inlinecode"><span class="id" title="var">wp_iris.refine_inv.root_inv</span></span>.

</li>
</ul>

<div class="paragraph"> </div>

Both lemmas apply Iris adequacy <span class="inlinecode"><a class="idref" href="bluerock.iris.extra.wp_io.iris.adequacy.html#wp_strong_adequacy_gen"><span class="id" title="lemma">wp_strong_adequacy_gen</span></a></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bluerock.iris.extra.wp_io.iris.adequacy.html#"><span class="id" title="library">bluerock.iris.extra.wp_io.iris.adequacy</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#"><span class="id" title="library">bluerock.iris.extra.wp_io.refinement.inv</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bluerock.iris.extra.base_logic.iprop_prop.html#"><span class="id" title="library">bluerock.iris.extra.base_logic.iprop_prop</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="refine_embed" class="idref" href="#refine_embed"><span class="id" title="module">refine_embed</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="refine_embed.with_lang" class="idref" href="#refine_embed.with_lang"><span class="id" title="section">with_lang</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="refine_embed.with_lang.cfg" class="idref" href="#refine_embed.with_lang.cfg"><span class="id" title="variable">cfg</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.config"><span class="id" title="record">Compose.config</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Let</span> <a id="31e175454ce18adf8f97e78fc905f5cd" class="idref" href="#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a> := <a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.lts_lang"><span class="id" title="definition">Compose.lts_lang</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.cfg"><span class="id" title="variable">cfg</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="refine_embed.with_lang.absE" class="idref" href="#refine_embed.with_lang.absE"><span class="id" title="variable">absE</span></a> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="refine_embed.with_lang.R" class="idref" href="#refine_embed.with_lang.R"><span class="id" title="variable">R</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.absE"><span class="id" title="variable">absE</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.event"><span class="id" title="projection">Compose.event</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.cfg"><span class="id" title="variable">cfg</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="refine_embed.with_lang.absLTS" class="idref" href="#refine_embed.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a> : <span class="id" title="abbreviation">LTS</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.absE"><span class="id" title="variable">absE</span></a>}.<br/>

<br/>
</div>

<div class="doc">
  If the client can prove
  <span class="inlinecode"><span class="id" title="var">AuthSet.frag</span></span> <span class="inlinecode"><span class="id" title="var">γ_abs</span></span> <span class="inlinecode">{[<span class="id" title="var">s_init</span>]}</span> <span class="inlinecode">-∗</span> <span class="inlinecode"><span class="id" title="var">root.wp_embed</span></span> <span class="inlinecode"><a class="idref" href="bluerock.iris.extra.wp_io.refinement.wp_io.html#root_aux_1.root.wp_io.R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode"><span class="id" title="var">γ_abs</span></span> <span class="inlinecode"><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.weakestpre.html#MaybeStuck"><span class="id" title="constructor">MaybeStuck</span></a></span> <span class="inlinecode">⊤</span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><a class="idref" href="bluerock.iris.extra.bi.atomic_update_properties.html#d56527481c5949ea5815316f50efa650"><span class="id" title="variable">Φ</span></a></span>
  that is, a WPio for the concrete configuration <span class="inlinecode"><span class="id" title="var">e</span></span> assuming the abstract
  machine state <span class="inlinecode"><span class="id" title="var">s_init</span></span>, then we can extract a trace refinement.

<div class="paragraph"> </div>

  The client picks the initial abstract state <span class="inlinecode"><span class="id" title="var">s_init</span></span>.
  We also require that the initial configuration has empty past trace, that is
  <span class="inlinecode">σ1.1.*1</span> <span class="inlinecode">=</span> <span class="inlinecode">[]</span>.

<div class="paragraph"> </div>

  TODOs:
<ul class="doclist">
<li> we can generalize this for the client to pick <span class="inlinecode"><span class="id" title="var">s_init</span></span> much earlier

</li>
<li> we can generalize the initial configuration to arbitrary state and
    past trace, we only need to remember those initial state and trace.

</li>
</ul>
  
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="refine_embed.trace_refinement_adequacy" class="idref" href="#refine_embed.trace_refinement_adequacy"><span class="id" title="lemma">trace_refinement_adequacy</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="48bbc240c70629f9166b6605559525f0" class="idref" href="#48bbc240c70629f9166b6605559525f0"><span class="id" title="binder">Σ</span></a> `{<a id="invGpreS0:6" class="idref" href="#invGpreS0:6"><span class="id" title="binder">!</span></a><a id="invGpreS0:6" class="idref" href="#invGpreS0:6"><span class="id" title="binder">invGpreS</span></a> <a id="invGpreS0:6" class="idref" href="#invGpreS0:6"><span class="id" title="binder">Σ</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">!</span></a><a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">AuthSet.G</span></a> <a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">Σ</span></a> <a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">(</span></a><a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">lts_state</span></a> <a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">absLTS</span></a><a id="H:7" class="idref" href="#H:7"><span class="id" title="binder">)</span></a>} <span class="comment">(*&nbsp;for&nbsp;abstract&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="e:8" class="idref" href="#e:8"><span class="id" title="binder">e</span></a> (<a id="d17e606cab562cf96214f669d52553c3" class="idref" href="#d17e606cab562cf96214f669d52553c3"><span class="id" title="binder">σ1</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#state"><span class="id" title="projection">state</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a>) <a id="n:10" class="idref" href="#n:10"><span class="id" title="binder">n</span></a> <a id="8b1c5c52f0a06377627e06213705f061" class="idref" href="#8b1c5c52f0a06377627e06213705f061"><span class="id" title="binder">κs</span></a> <a id="t2:12" class="idref" href="#t2:12"><span class="id" title="binder">t2</span></a> <a id="c65a89aa865349df91b63136a77641d6" class="idref" href="#c65a89aa865349df91b63136a77641d6"><span class="id" title="binder">σ2</span></a> (<a id="num_laters_per_step:14" class="idref" href="#num_laters_per_step:14"><span class="id" title="binder">num_laters_per_step</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="INIT_EMPTY:15" class="idref" href="#INIT_EMPTY:15"><span class="id" title="binder">INIT_EMPTY</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#d17e606cab562cf96214f669d52553c3"><span class="id" title="variable">σ1</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.1'"><span class="id" title="notation">.1</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#5699004f90d3c9aa7b72c8644e5e3b1f"><span class="id" title="notation">.*1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">[]</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;WP&nbsp;of&nbsp;e&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">∀</span> <span class="id" title="notation">`{</span><a id="Hinv:16" class="idref" href="#Hinv:16"><span class="id" title="binder">Hinv</span></a> : !<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.fancy_updates.html#invGS_gen"><span class="id" title="class">invGS_gen</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.fancy_updates.html#HasNoLc"><span class="id" title="constructor">HasNoLc</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48bbc240c70629f9166b6605559525f0"><span class="id" title="variable">Σ</span></a><span class="id" title="notation">},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#b7d65d242d889c3e37aca6013a51bfad"><span class="id" title="notation">⊢</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#7500ef6d8f565186818a5daedd71bf2a"><span class="id" title="notation">|={</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#6c0a583aa94fbbce6fcf0f655cf1cbb7"><span class="id" title="notation">⊤</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#7500ef6d8f565186818a5daedd71bf2a"><span class="id" title="notation">}=&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">∃</span></a> <a id="s_init:17" class="idref" href="#s_init:17"><span class="id" title="binder">s_init</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a>.(<span class="id" title="projection">Sts._init_state</span>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:17"><span class="id" title="variable">s_init</span></a> <a class="idref" href="bluerock.iris.extra.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#3737660a6294eb9f7af6df17be5eb5a3"><span class="id" title="notation">∀</span></a> <a id="8c321f0c17e5f29d593ba17b2e81be3c" class="idref" href="#8c321f0c17e5f29d593ba17b2e81be3c"><span class="id" title="binder">γ_abs</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#3737660a6294eb9f7af6df17be5eb5a3"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.base_logic.lib.auth_set.html#AuthSet.frag"><span class="id" title="definition">AuthSet.frag</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#8c321f0c17e5f29d593ba17b2e81be3c"><span class="id" title="variable">γ_abs</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#bb8184054cdbc2cb76438a0b028fc3e8"><span class="id" title="notation">{[</span></a><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:17"><span class="id" title="variable">s_init</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#bb8184054cdbc2cb76438a0b028fc3e8"><span class="id" title="notation">]}</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6e96398fec71e244af9dd75e40876ca6"><span class="id" title="notation">-∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">∃</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">(</span></a><a id="stateI:19" class="idref" href="#stateI:19"><span class="id" title="binder">stateI</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#state"><span class="id" title="projection">state</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a> <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#observation"><span class="id" title="projection">observation</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a>) <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="notation">→</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iProp"><span class="id" title="abbreviation">iProp</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48bbc240c70629f9166b6605559525f0"><span class="id" title="variable">Σ</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="285a825432ce9655d75e70d7f57d697e" class="idref" href="#285a825432ce9655d75e70d7f57d697e"><span class="id" title="binder">Φ</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#val"><span class="id" title="projection">val</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a> <span class="id" title="notation">→</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iProp"><span class="id" title="abbreviation">iProp</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48bbc240c70629f9166b6605559525f0"><span class="id" title="variable">Σ</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="fork_post:21" class="idref" href="#fork_post:21"><span class="id" title="binder">fork_post</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#val"><span class="id" title="projection">val</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a> <span class="id" title="notation">→</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iProp"><span class="id" title="abbreviation">iProp</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48bbc240c70629f9166b6605559525f0"><span class="id" title="variable">Σ</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="state_interp_mono:22" class="idref" href="#state_interp_mono:22"><span class="id" title="binder">state_interp_mono</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">_</span> : <a class="idref" href="bluerock.iris.extra.wp_io.iris.ghost.html#irisGS_gen"><span class="id" title="class">irisGS_gen</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a> (<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iPropI"><span class="id" title="abbreviation">iPropI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48bbc240c70629f9166b6605559525f0"><span class="id" title="variable">Σ</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.iris.ghost.html#IrisG"><span class="id" title="constructor">IrisG</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#stateI:19"><span class="id" title="variable">stateI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#fork_post:21"><span class="id" title="variable">fork_post</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#num_laters_per_step:14"><span class="id" title="variable">num_laters_per_step</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#state_interp_mono:22"><span class="id" title="variable">state_interp_mono</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#stateI:19"><span class="id" title="variable">stateI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#d17e606cab562cf96214f669d52553c3"><span class="id" title="variable">σ1</span></a> 0 <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#8b1c5c52f0a06377627e06213705f061"><span class="id" title="variable">κs</span></a> 0 <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.wp_embed"><span class="id" title="definition">root.wp_embed</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.R"><span class="id" title="variable">R</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#8c321f0c17e5f29d593ba17b2e81be3c"><span class="id" title="variable">γ_abs</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.weakestpre.html#MaybeStuck"><span class="id" title="constructor">MaybeStuck</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#top"><span class="id" title="definition">top</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#e:8"><span class="id" title="variable">e</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#285a825432ce9655d75e70d7f57d697e"><span class="id" title="variable">Φ</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#nsteps"><span class="id" title="inductive">language.nsteps</span></a> (<span class="id" title="var">Λ</span>:=<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#31e175454ce18adf8f97e78fc905f5cd"><span class="id" title="variable">Λ</span></a>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#n:10"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="notation">[</span><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#e:8"><span class="id" title="variable">e</span></a><span class="id" title="notation">]</span><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#d17e606cab562cf96214f669d52553c3"><span class="id" title="variable">σ1</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#8b1c5c52f0a06377627e06213705f061"><span class="id" title="variable">κs</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#t2:12"><span class="id" title="variable">t2</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#c65a89aa865349df91b63136a77641d6"><span class="id" title="variable">σ2</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="s_init:23" class="idref" href="#s_init:23"><span class="id" title="binder">s_init</span></a> <a id="s:24" class="idref" href="#s:24"><span class="id" title="binder">s</span></a> <a id="tr_abs:25" class="idref" href="#tr_abs:25"><span class="id" title="binder">tr_abs</span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a>.(<span class="id" title="projection">Sts._init_state</span>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:23"><span class="id" title="variable">s_init</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="inductive">reachable</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:23"><span class="id" title="variable">s_init</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#tr_abs:25"><span class="id" title="variable">tr_abs</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s:24"><span class="id" title="variable">s</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vis_abs:26" class="idref" href="#vis_abs:26"><span class="id" title="binder">vis_abs</span></a> := <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#filter"><span class="id" title="definition">filter</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#is_Some"><span class="id" title="definition">is_Some</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#tr_abs:25"><span class="id" title="variable">tr_abs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vis_con:27" class="idref" href="#vis_con:27"><span class="id" title="binder">vis_con</span></a> := <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#filter"><span class="id" title="definition">filter</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#is_Some"><span class="id" title="definition">is_Some</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#8b1c5c52f0a06377627e06213705f061"><span class="id" title="variable">κs</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#5699004f90d3c9aa7b72c8644e5e3b1f"><span class="id" title="notation">.*1</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;tau's&nbsp;filtered&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="inductive">Forall2</span> (<a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#option_Forall2"><span class="id" title="inductive">option_Forall2</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.R"><span class="id" title="variable">R</span></a>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#vis_abs:26"><span class="id" title="variable">vis_abs</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#vis_con:27"><span class="id" title="variable">vis_con</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hwp</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Iris&nbsp;general&nbsp;adequacy&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> : (<a class="idref" href="bluerock.iris.extra.wp_io.iris.adequacy.html#wp_strong_adequacy_gen"><span class="id" title="lemma">wp_strong_adequacy_gen</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.weakestpre.html#MaybeStuck"><span class="id" title="constructor">MaybeStuck</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">num_laters_per_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">last</span> <span class="id" title="tactic">exact</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hinv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;extracting&nbsp;user's&nbsp;WP&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<span class="id" title="var">Hwp</span> <span class="id" title="var">Hinv</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">s_init</span> <span class="id" title="var">INIT</span>) "WP".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;setting&nbsp;up&nbsp;ghost&nbsp;state&nbsp;for&nbsp;refinement&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.trace_refine_alloc"><span class="id" title="lemma">root.trace_refine_alloc</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.R"><span class="id" title="variable">R</span></a> <span class="id" title="var">s_init</span> <span class="id" title="var">INIT</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">γ_abs</span>) "[F RT]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"WP" <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "F"<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">stateI</span> <span class="id" title="var">Φ</span> <span class="id" title="var">fork_post</span> ?) "[SI WP]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> (<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.refine_embed_stateI"><span class="id" title="definition">root.refine_embed_stateI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang.R"><span class="id" title="variable">R</span></a> <span class="id" title="var">γ_abs</span>), <span class="id" title="notation">[</span><span class="id" title="var">Φ</span><span class="id" title="notation">]</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "WP".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.refine_embed_stateI"><span class="id" title="definition">root.refine_embed_stateI</span></a> <span class="id" title="var">INIT_EMPTY</span>. <span class="id" title="var">iFrame</span> "RT SI".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitR</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;extracting&nbsp;refinement&nbsp;relation&nbsp;from&nbsp;<span class="inlinecode"><span class="id" title="var">state_interp</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">es'</span> <span class="id" title="var">ts'</span> <span class="id" title="var">Eqt2</span> <span class="id" title="var">EqLes'</span> ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(RF &amp; SI) ? ?".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#fupd_mask_intro"><span class="id" title="lemma">fupd_mask_intro</span></a>; [<span class="id" title="var">solve_ndisj</span>|]. <span class="id" title="var">iIntros</span> "Close'".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "RF" <span class="id" title="keyword">as</span> (<span class="id" title="var">tr_abs</span>) "(absA &amp; %RF)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "absA" <span class="id" title="keyword">as</span> (<span class="id" title="var">ss</span>) "(? &amp; %FACT)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!%".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">FACT</span> <span class="id" title="keyword">as</span> ([<span class="id" title="var">s</span> <span class="id" title="var">Inss</span>] &amp; <span class="id" title="var">s_init'</span> &amp; <span class="id" title="var">INIT'</span> &amp; <span class="id" title="var">REACH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">s_init'</span>, <span class="id" title="var">s</span>, <span class="id" title="var">tr_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">REACH</span> <span class="id" title="var">_</span> <span class="id" title="var">Inss</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; [<span class="id" title="var">done</span>..|].<br/>
</div>

<div class="doc">
    Here we needs σ2.1.*1 = κs.*1.
    Fortunately, <span class="inlinecode"><span class="id" title="var">Compose.lts_lang</span></span> satisfies this property.
    When generalizing the language, we need to remember this requirement.
    
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.nsteps_trace_final"><span class="id" title="lemma">Compose.nsteps_trace_final</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">INIT_EMPTY</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> -<span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed.with_lang"><span class="id" title="section">with_lang</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_embed"><span class="id" title="module">refine_embed</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="refine_inv" class="idref" href="#refine_inv"><span class="id" title="module">refine_inv</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="refine_inv.with_lang" class="idref" href="#refine_inv.with_lang"><span class="id" title="section">with_lang</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="refine_inv.with_lang.cfg" class="idref" href="#refine_inv.with_lang.cfg"><span class="id" title="variable">cfg</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.config"><span class="id" title="record">Compose.config</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Let</span> <a id="4546ecf387c51ed45fd71bb252095ff4" class="idref" href="#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a> := <a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.lts_lang"><span class="id" title="definition">Compose.lts_lang</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.cfg"><span class="id" title="variable">cfg</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="refine_inv.with_lang.absE" class="idref" href="#refine_inv.with_lang.absE"><span class="id" title="variable">absE</span></a> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<a id="refine_inv.with_lang.R" class="idref" href="#refine_inv.with_lang.R"><span class="id" title="variable">R</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.absE"><span class="id" title="variable">absE</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.event"><span class="id" title="projection">Compose.event</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.cfg"><span class="id" title="variable">cfg</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="refine_inv.with_lang.absLTS" class="idref" href="#refine_inv.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a> : <span class="id" title="abbreviation">LTS</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.absE"><span class="id" title="variable">absE</span></a>}.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Lemma</span> <a id="refine_inv.ghost_trace_refine_inv_alloc" class="idref" href="#refine_inv.ghost_trace_refine_inv_alloc"><span class="id" title="lemma">ghost_trace_refine_inv_alloc</span></a> {<a id="1beca3efe5883c5b6c82a78600a11ca9" class="idref" href="#1beca3efe5883c5b6c82a78600a11ca9"><span class="id" title="binder">Σ</span></a>} `{<a id="invGS_gen0:34" class="idref" href="#invGS_gen0:34"><span class="id" title="binder">!</span></a><a id="invGS_gen0:34" class="idref" href="#invGS_gen0:34"><span class="id" title="binder">invGS_gen</span></a> <a id="hlc:33" class="idref" href="#hlc:33"><span class="id" title="binder"><span id="invGS_gen0:34" class="id">hlc</span></span></a> <a id="invGS_gen0:34" class="idref" href="#invGS_gen0:34"><span class="id" title="binder">Σ</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">!</span></a><a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">AuthSet.G</span></a> <a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">Σ</span></a> <a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">(</span></a><a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">lts_state</span></a> <a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">absLTS</span></a><a id="H:35" class="idref" href="#H:35"><span class="id" title="binder">)</span></a>}             <span class="comment">(*&nbsp;for&nbsp;abstract&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">!</span></a><a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">mono_list.G</span></a> <a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">Σ</span></a> <a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">(</span></a><a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">option</span></a> <a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">(</span></a><a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">Compose.event</span></a> <a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">cfg</span></a><a id="H0:36" class="idref" href="#H0:36"><span class="id" title="binder">))</span></a>} <span class="comment">(*&nbsp;for&nbsp;concrete&nbsp;trace&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="N:37" class="idref" href="#N:37"><span class="id" title="binder">N</span></a> <a id="E:38" class="idref" href="#E:38"><span class="id" title="binder">E</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="s_init:39" class="idref" href="#s_init:39"><span class="id" title="binder">s_init</span></a> (<a id="INIT:40" class="idref" href="#INIT:40"><span class="id" title="binder">INIT</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a>.(<span class="id" title="projection">Sts._init_state</span>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:39"><span class="id" title="variable">s_init</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#ffadc36515beeadab0b826539fe438d6"><span class="id" title="notation">⊢@{</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iPropI"><span class="id" title="abbreviation">iPropI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#1beca3efe5883c5b6c82a78600a11ca9"><span class="id" title="variable">Σ</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#ffadc36515beeadab0b826539fe438d6"><span class="id" title="notation">}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#7500ef6d8f565186818a5daedd71bf2a"><span class="id" title="notation">|={</span></a><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#E:38"><span class="id" title="variable">E</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#7500ef6d8f565186818a5daedd71bf2a"><span class="id" title="notation">}=&gt;</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">∃</span></a> <a id="0ef80d4b079b725b19e958203e9fca06" class="idref" href="#0ef80d4b079b725b19e958203e9fca06"><span class="id" title="binder">γ_con</span></a> <a id="c6e537c268e404183c7de36c234f7c31" class="idref" href="#c6e537c268e404183c7de36c234f7c31"><span class="id" title="binder">γ_abs</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.ghost_trace_refine_inv"><span class="id" title="definition">root.ghost_trace_refine_inv</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.R"><span class="id" title="variable">R</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#0ef80d4b079b725b19e958203e9fca06"><span class="id" title="variable">γ_con</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#c6e537c268e404183c7de36c234f7c31"><span class="id" title="variable">γ_abs</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#N:37"><span class="id" title="variable">N</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.base_logic.lib.auth_set.html#AuthSet.frag"><span class="id" title="definition">AuthSet.frag</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#c6e537c268e404183c7de36c234f7c31"><span class="id" title="variable">γ_abs</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#bb8184054cdbc2cb76438a0b028fc3e8"><span class="id" title="notation">{[</span></a><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:39"><span class="id" title="variable">s_init</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#bb8184054cdbc2cb76438a0b028fc3e8"><span class="id" title="notation">]}</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.base_logic.lib.mono_list.html#mono_list.half"><span class="id" title="definition">mono_list.half</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#0ef80d4b079b725b19e958203e9fca06"><span class="id" title="variable">γ_con</span></a> <span class="id" title="notation">[]</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<a class="idref" href="bluerock.iris.extra.base_logic.lib.mono_list.html#mono_list.half_alloc"><span class="id" title="lemma">mono_list.half_alloc</span></a> <span class="id" title="notation">[]</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">γ_con</span>) "[h1 h2]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.trace_refine_alloc"><span class="id" title="lemma">root.trace_refine_alloc</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.R"><span class="id" title="variable">R</span></a> <span class="id" title="var">s_init</span> <span class="id" title="var">INIT</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">γ_abs</span>) "[F RT]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">γ_con</span>, <span class="id" title="var">γ_abs</span>. <span class="id" title="var">iFrame</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO&nbsp;cleanup&nbsp;:&nbsp;inlining&nbsp;<span class="inlinecode"><span class="id" title="var">bluerock.iris.extra.base_logic.iprop_invariants</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;because&nbsp;that&nbsp;one&nbsp;is&nbsp;fixed&nbsp;to&nbsp;the&nbsp;default&nbsp;<span class="inlinecode"><span class="id" title="var">invGS_gen</span></span> <span class="inlinecode"><span class="id" title="var">HasLc</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.invariants.html#own_inv_alloc"><span class="id" title="lemma">own_inv_alloc</span></a> <span class="id" title="var">N</span> <span class="id" title="var">E</span> (<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.ghost_trace_refine"><span class="id" title="definition">root.ghost_trace_refine</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.R"><span class="id" title="variable">R</span></a> <span class="id" title="var">γ_con</span> <span class="id" title="var">γ_abs</span>) <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "[-]"<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "#INV".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iNext</span>. <span class="id" title="var">iExists</span> <span class="id" title="notation">[]</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.ghost_trace_refine_inv"><span class="id" title="definition">root.ghost_trace_refine_inv</span></a> <a class="idref" href="bluerock.iris.extra.bi.invariants.html#inv_eq"><span class="id" title="definition">inv_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">E'</span> <span class="id" title="var">SubE'</span>) "!#".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iMod</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.invariants.html#own_inv_acc"><span class="id" title="lemma">own_inv_acc</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "[$]"<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  If the client can prove
  <span class="inlinecode"><span class="id" title="var">AuthSet.frag</span></span> <span class="inlinecode"><span class="id" title="var">γ_abs</span></span> <span class="inlinecode">{[<span class="id" title="var">s_init</span>]}</span> <span class="inlinecode">-∗</span> <span class="inlinecode"><span class="id" title="var">root.wp_embed</span></span> <span class="inlinecode"><a class="idref" href="bluerock.iris.extra.wp_io.refinement.wp_io.html#root_aux_1.root.wp_io.R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode"><span class="id" title="var">γ_abs</span></span> <span class="inlinecode"><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.weakestpre.html#MaybeStuck"><span class="id" title="constructor">MaybeStuck</span></a></span> <span class="inlinecode">⊤</span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><a class="idref" href="bluerock.iris.extra.bi.atomic_update_properties.html#d56527481c5949ea5815316f50efa650"><span class="id" title="variable">Φ</span></a></span>
  that is, a WPio for the concrete configuration <span class="inlinecode"><span class="id" title="var">e</span></span> assuming the abstract
  machine state <span class="inlinecode"><span class="id" title="var">s_init</span></span>, then we can extract a trace refinement.

<div class="paragraph"> </div>

  The client picks the initial abstract state <span class="inlinecode"><span class="id" title="var">s_init</span></span>.
  We also require that the initial configuration has empty past trace, that is
  <span class="inlinecode">σ1.1.*1</span> <span class="inlinecode">=</span> <span class="inlinecode">[]</span>.

<div class="paragraph"> </div>

  TODOs:
<ul class="doclist">
<li> we can generalize this for the client to pick <span class="inlinecode"><span class="id" title="var">s_init</span></span> much earlier

</li>
<li> we can generalize the initial configuration to arbitrary state and
    past trace, we only need to remember those initial state and trace.

</li>
</ul>
  
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="refine_inv.trace_refinement_adequacy" class="idref" href="#refine_inv.trace_refinement_adequacy"><span class="id" title="lemma">trace_refinement_adequacy</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ea478fd00cb4a06cc640b1b27bf65159" class="idref" href="#ea478fd00cb4a06cc640b1b27bf65159"><span class="id" title="binder">Σ</span></a> `{<a id="invGpreS0:44" class="idref" href="#invGpreS0:44"><span class="id" title="binder">!</span></a><a id="invGpreS0:44" class="idref" href="#invGpreS0:44"><span class="id" title="binder">invGpreS</span></a> <a id="invGpreS0:44" class="idref" href="#invGpreS0:44"><span class="id" title="binder">Σ</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">!</span></a><a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">AuthSet.G</span></a> <a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">Σ</span></a> <a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">(</span></a><a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">lts_state</span></a> <a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">absLTS</span></a><a id="H:45" class="idref" href="#H:45"><span class="id" title="binder">)</span></a>}             <span class="comment">(*&nbsp;for&nbsp;abstract&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">!</span></a><a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">mono_list.G</span></a> <a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">Σ</span></a> <a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">(</span></a><a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">option</span></a> <a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">(</span></a><a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">Compose.event</span></a> <a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">cfg</span></a><a id="H0:46" class="idref" href="#H0:46"><span class="id" title="binder">))</span></a>} <span class="comment">(*&nbsp;for&nbsp;concrete&nbsp;trace&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="N:47" class="idref" href="#N:47"><span class="id" title="binder">N</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.namespaces.html#namespace"><span class="id" title="definition">namespace</span></a>)  <span class="comment">(*&nbsp;namespace&nbsp;for&nbsp;refinement&nbsp;invariant&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="e:48" class="idref" href="#e:48"><span class="id" title="binder">e</span></a> (<a id="87bfdd3662953cd5d54c15354a10acdc" class="idref" href="#87bfdd3662953cd5d54c15354a10acdc"><span class="id" title="binder">σ1</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#state"><span class="id" title="projection">state</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a>) <a id="n:50" class="idref" href="#n:50"><span class="id" title="binder">n</span></a> <a id="48adf463951ed051318d4cff3582fe32" class="idref" href="#48adf463951ed051318d4cff3582fe32"><span class="id" title="binder">κs</span></a> <a id="t2:52" class="idref" href="#t2:52"><span class="id" title="binder">t2</span></a> <a id="9d3f756c5f21045ecc25e89ba7980843" class="idref" href="#9d3f756c5f21045ecc25e89ba7980843"><span class="id" title="binder">σ2</span></a> (<a id="num_laters_per_step:54" class="idref" href="#num_laters_per_step:54"><span class="id" title="binder">num_laters_per_step</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="INIT_EMPTY:55" class="idref" href="#INIT_EMPTY:55"><span class="id" title="binder">INIT_EMPTY</span></a> : <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#87bfdd3662953cd5d54c15354a10acdc"><span class="id" title="variable">σ1</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.1'"><span class="id" title="notation">.1</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#5699004f90d3c9aa7b72c8644e5e3b1f"><span class="id" title="notation">.*1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">[]</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;WP&nbsp;of&nbsp;e&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">∀</span> <span class="id" title="notation">`{</span><a id="Hinv:56" class="idref" href="#Hinv:56"><span class="id" title="binder">Hinv</span></a> : !<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.fancy_updates.html#invGS_gen"><span class="id" title="class">invGS_gen</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.fancy_updates.html#HasNoLc"><span class="id" title="constructor">HasNoLc</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#ea478fd00cb4a06cc640b1b27bf65159"><span class="id" title="variable">Σ</span></a><span class="id" title="notation">},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#b7d65d242d889c3e37aca6013a51bfad"><span class="id" title="notation">⊢</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#7500ef6d8f565186818a5daedd71bf2a"><span class="id" title="notation">|={</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#6c0a583aa94fbbce6fcf0f655cf1cbb7"><span class="id" title="notation">⊤</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#7500ef6d8f565186818a5daedd71bf2a"><span class="id" title="notation">}=&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">∃</span></a> <a id="s_init:57" class="idref" href="#s_init:57"><span class="id" title="binder">s_init</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a>.(<span class="id" title="projection">Sts._init_state</span>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:57"><span class="id" title="variable">s_init</span></a> <a class="idref" href="bluerock.iris.extra.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#3737660a6294eb9f7af6df17be5eb5a3"><span class="id" title="notation">∀</span></a> <a id="2ede3ca4f79c031112dd0cb9a1e71060" class="idref" href="#2ede3ca4f79c031112dd0cb9a1e71060"><span class="id" title="binder">γ_abs</span></a> <a id="e21b25d9650b6d8ff92b0cdbc7a5a1f2" class="idref" href="#e21b25d9650b6d8ff92b0cdbc7a5a1f2"><span class="id" title="binder">γ_con</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#3737660a6294eb9f7af6df17be5eb5a3"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.ghost_trace_refine_inv"><span class="id" title="definition">root.ghost_trace_refine_inv</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.R"><span class="id" title="variable">R</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#e21b25d9650b6d8ff92b0cdbc7a5a1f2"><span class="id" title="variable">γ_con</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#2ede3ca4f79c031112dd0cb9a1e71060"><span class="id" title="variable">γ_abs</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#N:47"><span class="id" title="variable">N</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6e96398fec71e244af9dd75e40876ca6"><span class="id" title="notation">-∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.base_logic.lib.auth_set.html#AuthSet.frag"><span class="id" title="definition">AuthSet.frag</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#2ede3ca4f79c031112dd0cb9a1e71060"><span class="id" title="variable">γ_abs</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#bb8184054cdbc2cb76438a0b028fc3e8"><span class="id" title="notation">{[</span></a><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:57"><span class="id" title="variable">s_init</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#bb8184054cdbc2cb76438a0b028fc3e8"><span class="id" title="notation">]}</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6e96398fec71e244af9dd75e40876ca6"><span class="id" title="notation">-∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">∃</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">(</span></a><a id="stateI:60" class="idref" href="#stateI:60"><span class="id" title="binder">stateI</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#state"><span class="id" title="projection">state</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a> <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#observation"><span class="id" title="projection">observation</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a>) <span class="id" title="notation">→</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="notation">→</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iProp"><span class="id" title="abbreviation">iProp</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#ea478fd00cb4a06cc640b1b27bf65159"><span class="id" title="variable">Σ</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="d104da34b9506e4cd4fc5bf1a73cc7b3" class="idref" href="#d104da34b9506e4cd4fc5bf1a73cc7b3"><span class="id" title="binder">Φ</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#val"><span class="id" title="projection">val</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a> <span class="id" title="notation">→</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iProp"><span class="id" title="abbreviation">iProp</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#ea478fd00cb4a06cc640b1b27bf65159"><span class="id" title="variable">Σ</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="fork_post:62" class="idref" href="#fork_post:62"><span class="id" title="binder">fork_post</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#val"><span class="id" title="projection">val</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a> <span class="id" title="notation">→</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iProp"><span class="id" title="abbreviation">iProp</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#ea478fd00cb4a06cc640b1b27bf65159"><span class="id" title="variable">Σ</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="state_interp_mono:63" class="idref" href="#state_interp_mono:63"><span class="id" title="binder">state_interp_mono</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">_</span> : <a class="idref" href="bluerock.iris.extra.wp_io.iris.ghost.html#irisGS_gen"><span class="id" title="class">irisGS_gen</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a> (<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.base_logic.lib.iprop.html#iProp_solution.iPropI"><span class="id" title="abbreviation">iPropI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#ea478fd00cb4a06cc640b1b27bf65159"><span class="id" title="variable">Σ</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.iris.ghost.html#IrisG"><span class="id" title="constructor">IrisG</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#stateI:60"><span class="id" title="variable">stateI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#fork_post:62"><span class="id" title="variable">fork_post</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#num_laters_per_step:54"><span class="id" title="variable">num_laters_per_step</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#state_interp_mono:63"><span class="id" title="variable">state_interp_mono</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#stateI:60"><span class="id" title="variable">stateI</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#87bfdd3662953cd5d54c15354a10acdc"><span class="id" title="variable">σ1</span></a> 0 <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48adf463951ed051318d4cff3582fe32"><span class="id" title="variable">κs</span></a> 0 <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.wp_inv"><span class="id" title="definition">root.wp_inv</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#e21b25d9650b6d8ff92b0cdbc7a5a1f2"><span class="id" title="variable">γ_con</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.weakestpre.html#MaybeStuck"><span class="id" title="constructor">MaybeStuck</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#top"><span class="id" title="definition">top</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#e:48"><span class="id" title="variable">e</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#d104da34b9506e4cd4fc5bf1a73cc7b3"><span class="id" title="variable">Φ</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.program_logic.language.html#nsteps"><span class="id" title="inductive">language.nsteps</span></a> (<span class="id" title="var">Λ</span>:=<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#4546ecf387c51ed45fd71bb252095ff4"><span class="id" title="variable">Λ</span></a>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#n:50"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="notation">[</span><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#e:48"><span class="id" title="variable">e</span></a><span class="id" title="notation">]</span><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#87bfdd3662953cd5d54c15354a10acdc"><span class="id" title="variable">σ1</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48adf463951ed051318d4cff3582fe32"><span class="id" title="variable">κs</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#t2:52"><span class="id" title="variable">t2</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#9d3f756c5f21045ecc25e89ba7980843"><span class="id" title="variable">σ2</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="notation">→</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="s_init:64" class="idref" href="#s_init:64"><span class="id" title="binder">s_init</span></a> <a id="s:65" class="idref" href="#s:65"><span class="id" title="binder">s</span></a> <a id="tr_abs:66" class="idref" href="#tr_abs:66"><span class="id" title="binder">tr_abs</span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a>.(<span class="id" title="projection">Sts._init_state</span>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:64"><span class="id" title="variable">s_init</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="inductive">reachable</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.absLTS"><span class="id" title="variable">absLTS</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s_init:64"><span class="id" title="variable">s_init</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#tr_abs:66"><span class="id" title="variable">tr_abs</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#s:65"><span class="id" title="variable">s</span></a> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vis_abs:67" class="idref" href="#vis_abs:67"><span class="id" title="binder">vis_abs</span></a> := <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#filter"><span class="id" title="definition">filter</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#is_Some"><span class="id" title="definition">is_Some</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#tr_abs:66"><span class="id" title="variable">tr_abs</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vis_con:68" class="idref" href="#vis_con:68"><span class="id" title="binder">vis_con</span></a> := <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#filter"><span class="id" title="definition">filter</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#is_Some"><span class="id" title="definition">is_Some</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#48adf463951ed051318d4cff3582fe32"><span class="id" title="variable">κs</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#5699004f90d3c9aa7b72c8644e5e3b1f"><span class="id" title="notation">.*1</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;tau's&nbsp;filtered&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="inductive">Forall2</span> (<a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#option_Forall2"><span class="id" title="inductive">option_Forall2</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang.R"><span class="id" title="variable">R</span></a>) <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#vis_abs:67"><span class="id" title="variable">vis_abs</span></a> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#vis_con:68"><span class="id" title="variable">vis_con</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hwp</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Iris&nbsp;general&nbsp;adequacy&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> : (<a class="idref" href="bluerock.iris.extra.wp_io.iris.adequacy.html#wp_strong_adequacy_gen"><span class="id" title="lemma">wp_strong_adequacy_gen</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.weakestpre.html#MaybeStuck"><span class="id" title="constructor">MaybeStuck</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">num_laters_per_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">last</span> <span class="id" title="tactic">exact</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hinv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;extracting&nbsp;user's&nbsp;WP&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<span class="id" title="var">Hwp</span> <span class="id" title="var">Hinv</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">s_init</span> <span class="id" title="var">INIT</span>) "WP".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;setting&nbsp;up&nbsp;ghost&nbsp;state&nbsp;for&nbsp;refinement&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.ghost_trace_refine_inv_alloc"><span class="id" title="lemma">ghost_trace_refine_inv_alloc</span></a> <span class="id" title="var">N</span> <span class="id" title="var">_</span> <span class="id" title="var">s_init</span> <span class="id" title="var">INIT</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> (<span class="id" title="var">γ_con</span> <span class="id" title="var">γ_abs</span>) "(#INV &amp; F &amp; H)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"WP" <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "INV F"<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">stateI</span> <span class="id" title="var">Φ</span> <span class="id" title="var">fork_post</span> ?) "[SI WP]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> (<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.refine_inv_stateI"><span class="id" title="definition">root.refine_inv_stateI</span></a> <span class="id" title="var">γ_con</span>), <span class="id" title="notation">[</span><span class="id" title="var">Φ</span><span class="id" title="notation">]</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "WP".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bluerock.iris.extra.wp_io.refinement.inv.html#root_aux_1.root.refine_inv_stateI"><span class="id" title="definition">root.refine_inv_stateI</span></a> <span class="id" title="var">INIT_EMPTY</span>. <span class="id" title="var">iFrame</span> "H SI".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitR</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;extracting&nbsp;refinement&nbsp;relation&nbsp;from&nbsp;<span class="inlinecode"><span class="id" title="var">state_interp</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">es'</span> <span class="id" title="var">ts'</span> <span class="id" title="var">Eqt2</span> <span class="id" title="var">EqLes'</span> ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(H &amp; SI) ? ?".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInv</span> "INV"  <span class="id" title="keyword">as</span> (<span class="id" title="var">tr_con</span>) "&gt;[H' RF]" "CloseI".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.updates.html#fupd_mask_intro"><span class="id" title="lemma">fupd_mask_intro</span></a>; [<span class="id" title="var">solve_ndisj</span>|]. <span class="id" title="var">iIntros</span> "Close'".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="bluerock.iris.extra.base_logic.lib.mono_list.html#mono_list.half_agree"><span class="id" title="lemma">mono_list.half_agree</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "H' H"<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> %-&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "RF" <span class="id" title="keyword">as</span> (<span class="id" title="var">tr_abs</span>) "(absA &amp; %RF)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "absA" <span class="id" title="keyword">as</span> (<span class="id" title="var">ss</span>) "(? &amp; %FACT)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!%".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">FACT</span> <span class="id" title="keyword">as</span> ([<span class="id" title="var">s</span> <span class="id" title="var">Inss</span>] &amp; <span class="id" title="var">s_init'</span> &amp; <span class="id" title="var">INIT'</span> &amp; <span class="id" title="var">REACH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">s_init'</span>, <span class="id" title="var">s</span>, <span class="id" title="var">tr_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">REACH</span> <span class="id" title="var">_</span> <span class="id" title="var">Inss</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; [<span class="id" title="var">done</span>..|].<br/>
</div>

<div class="doc">
    Here we needs σ2.1.*1 = κs.*1.
    Fortunately, <span class="inlinecode"><span class="id" title="var">Compose.lts_lang</span></span> satisfies this property.
    When generalizing the language, we need to remember this requirement.
    
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="bluerock.iris.extra.wp_io.lang.html#Compose.nsteps_trace_final"><span class="id" title="lemma">Compose.nsteps_trace_final</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">INIT_EMPTY</span> <span class="id" title="lemma">app_nil_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> -<span class="id" title="var">STEPS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv.with_lang"><span class="id" title="section">with_lang</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bluerock.iris.extra.wp_io.refinement.adequacy.html#refine_inv"><span class="id" title="module">refine_inv</span></a>.<br/>
</div>
<!--
-- Copyright (c) 2020 BlueRock Security, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
